banner: |
    █████  ███  ████  █   █  ███  ████
      █   █   █ █   █ █   █   █  █    
      █   █████ ████  █   █   █   ███ 
    █ █   █   █ █  █   █ █    █      █
     ██   █   █ █   █   █    ███  ████
# 地址: https://github.com/Jarv1s0/Proxy_Script
# 版本: v2.1
# 更新: 2026 年 2 月 3 日

# ==================== 核心配置 ====================
# 基础配置
mode: rule
port: 7890
socks-port: 7891
redir-port: 7892
mixed-port: 7893
tproxy-port: 7895
ipv6: false
allow-lan: true
unified-delay: true
tcp-concurrent: true
log-level: warning
bind-address: '*'
find-process-mode: 'always'
keep-alive-interval: 15
keep-alive-idle: 600

# TUN模式配置
tun:
  enable: true
  stack: mixed
  dns-hijack:
    - "any:53"
    - "tcp://any:53"
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true
    
# DNS配置
dns:
  enable: true
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  # 解析上游 DoH/DoT 的起始 DNS
  default-nameserver:
    - tls://223.5.5.5
    - tls://223.6.6.6
  # 代理路径用的国外上游（仅对需代理的非直连规则集域名）
  nameserver:
    - "https://cloudflare-dns.com/dns-query"
    - "https://dns.google/dns-query"
  # 直连路径专用上游（国内 DoH）
  direct-nameserver:
    - "https://dns.alidns.com/dns-query"
    - "https://doh.pub/dns-query"
  # 解析代理服务器的域名，防循环用国内
  proxy-server-nameserver:
    - "https://dns.alidns.com/dns-query"
    - "https://doh.pub/dns-query"
  # 配置查询访问域名使用的服务器
  nameserver-policy:
    # 直连类规则集匹配的域名绑定国内上游，首跳即国内，不触发国外→国内回切
    "rule-set:Direct,Private,China,fakeip-filter":
      - "https://dns.alidns.com/dns-query"
      - "https://doh.pub/dns-query"
  fake-ip-filter:
    - rule-set:Direct
    - rule-set:Private
    - rule-set:China
    - rule-set:fakeip-filter

# ==================== 代理策略组 ====================
proxy-groups:
- { name: Proxy, type: select, proxies: [ "美国-Texas" ] }
# ==================== 规则集定义 (全量保留) ====================
BehaviorDN: &BehaviorDN {type: http, behavior: domain, format: mrs, interval: 86400, proxy: Proxy}
BehaviorIP: &BehaviorIP {type: http, behavior: ipcidr, format: mrs, interval: 86400, proxy: Proxy}

rule-providers:  
  Tracking:      {<<: *BehaviorDN, url: https://github.com/666OS/rules/raw/release/mihomo/domain/Tracking.mrs}
  Advertising:   {<<: *BehaviorDN, url: https://github.com/666OS/rules/raw/release/mihomo/domain/Advertising.mrs} 
  Direct:        {<<: *BehaviorDN, url: https://github.com/666OS/rules/raw/release/mihomo/domain/Direct.mrs}
  Private:       {<<: *BehaviorDN, url: https://github.com/DustinWin/ruleset_geodata/releases/download/mihomo-ruleset/private.mrs}
  Download:      {<<: *BehaviorDN, url: https://github.com/666OS/rules/raw/release/mihomo/domain/Download.mrs}
  fakeip-filter: {<<: *BehaviorDN, url: https://github.com/DustinWin/ruleset_geodata/releases/download/mihomo-ruleset/fakeip-filter.mrs}
  AI:            {<<: *BehaviorDN, url: https://github.com/DustinWin/ruleset_geodata/releases/download/mihomo-ruleset/ai.mrs} 
  GitHub:        {<<: *BehaviorDN, url: https://github.com/666OS/rules/raw/release/mihomo/domain/GitHub.mrs}    
  Telegram:      {<<: *BehaviorDN, url: https://github.com/666OS/rules/raw/release/mihomo/domain/Telegram.mrs}
  GamesCN:       {<<: *BehaviorDN, url: https://github.com/DustinWin/ruleset_geodata/releases/download/mihomo-ruleset/games-cn.mrs} 
  Games:         {<<: *BehaviorDN, url: https://github.com/DustinWin/ruleset_geodata/releases/download/mihomo-ruleset/games.mrs}
  YouTube:       {<<: *BehaviorDN, url: https://github.com/DustinWin/ruleset_geodata/releases/download/mihomo-ruleset/youtube.mrs}
  AppleCN:       {<<: *BehaviorDN, url: https://github.com/666OS/rules/raw/release/mihomo/domain/AppleCN.mrs}
  Google:        {<<: *BehaviorDN, url: https://github.com/666OS/rules/raw/release/mihomo/domain/Google.mrs}
  MicrosoftCN:   {<<: *BehaviorDN, url: https://github.com/DustinWin/ruleset_geodata/releases/download/mihomo-ruleset/microsoft-cn.mrs}  
  ProxySet:      {<<: *BehaviorDN, url: https://github.com/666OS/rules/raw/release/mihomo/domain/Proxy.mrs}
  China:         {<<: *BehaviorDN, url: https://github.com/DustinWin/ruleset_geodata/releases/download/mihomo-ruleset/cn.mrs}
  # IP 规则
  AdvertisingIP: {<<: *BehaviorIP, url: https://github.com/666OS/rules/raw/release/mihomo/ip/Advertising.mrs}
  PrivateIP:     {<<: *BehaviorIP, url: https://github.com/DustinWin/ruleset_geodata/releases/download/mihomo-ruleset/privateip.mrs}
  AIIP:          {<<: *BehaviorIP, url: https://github.com/666OS/rules/raw/release/mihomo/ip/AI.mrs}
  TelegramIP:    {<<: *BehaviorIP, url: https://github.com/DustinWin/ruleset_geodata/releases/download/mihomo-ruleset/telegramip.mrs}   
  GoogleIP:      {<<: *BehaviorIP, url: https://github.com/666OS/rules/raw/release/mihomo/ip/Google.mrs}  
  ProxyIP:       {<<: *BehaviorIP, url: https://github.com/666OS/rules/raw/release/mihomo/ip/Proxy.mrs} 
  ChinaIP:       {<<: *BehaviorIP, url: https://github.com/DustinWin/ruleset_geodata/releases/download/mihomo-ruleset/cnip.mrs}

# ==================== 规则路由 (全量指向 Proxy) ====================
rules:
  # 1. 优先自定义规则
  - DOMAIN-KEYWORD,1ytsub,DIRECT
  - DOMAIN-KEYWORD,jarv1s,Proxy
  - PROCESS-NAME,dota2.exe,DIRECT
  - PROCESS-NAME,language_server_windows_x64.exe,Proxy
  - PROCESS-NAME,Antigravity.exe,Proxy 

  # 2. 拦截
  - RULE-SET,Tracking,REJECT
  - RULE-SET,Advertising,REJECT
  - AND,((DST-PORT,443),(NETWORK,UDP),(NOT,((GEOIP,CN)))),REJECT 

  # 3. 域名分流 (全部指向 Proxy 或 DIRECT)
  - RULE-SET,Private,DIRECT
  - RULE-SET,Direct,DIRECT
  - RULE-SET,GamesCN,DIRECT
  - RULE-SET,Download,DIRECT
  - RULE-SET,AppleCN,DIRECT
  - RULE-SET,MicrosoftCN,DIRECT
  
  - RULE-SET,AI,Proxy
  - RULE-SET,GitHub,Proxy
  - RULE-SET,Telegram,Proxy
  - RULE-SET,Games,Proxy
  - RULE-SET,YouTube,Proxy
  - RULE-SET,Google,Proxy
  - RULE-SET,ProxySet,Proxy
  - RULE-SET,China,DIRECT

  # 4. IP 规则分流 (全部指向 Proxy 或 DIRECT)
  - RULE-SET,AdvertisingIP,REJECT,no-resolve
  - RULE-SET,PrivateIP,DIRECT,no-resolve
  - RULE-SET,AIIP,Proxy,no-resolve
  - RULE-SET,TelegramIP,Proxy,no-resolve
  - RULE-SET,GoogleIP,Proxy,no-resolve
  - RULE-SET,ProxyIP,Proxy,no-resolve
  - RULE-SET,ChinaIP,DIRECT,no-resolve

  # 5. 兜底
  - MATCH,Proxy